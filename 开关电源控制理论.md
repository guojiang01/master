# 开关电源控制理论

1. 简化的Buck电路：Buck变换器是降压开关变换器，通常可以建模为一个低阻抗方波发生器，后面跟一个LC网络。通过短路输入激励，可以得到网络的输出阻抗，是电感和电容的并联网络$Z_{out}=(sL_{out}+r_L )\lVert (r_C+\frac{1}{sC_{out}})$.通过观察可以看出，直流情况下，电感电阻支路中的${R_L}$占网络阻抗的主导地位（直流时$L_{out}$短路，$C_{out}$开路），当频率升高时，电感开始起作用。频率继续升高，电容器支路开始取代电感支路，直到电容可以被认为短路，只剩下其串联损耗电阻$R_C$。![简化阻抗模型.png](https://s2.loli.net/2023/08/04/bnuVAT3omR27C6s.png) ![输出阻抗.png](https://s2.loli.net/2023/08/04/iyKJrT8sPOexjlt.png) 

   在谐振频率$f_0$处出现了一个尖峰。如果忽略掉电容ESR，可以得到这个谐振尖峰的最大值。 $Z_{out,max}=\frac{Z_0^2}{r_L}\sqrt{1+(\frac{r_L}{Z_0})^2}$，$Z_0$是滤波器的特征阻抗，$Z_0=\sqrt{\frac{L_{out}}{C_{out}}}$ ，$r_L$是电感的串联电阻。这个尖峰是Buck电路输出阻抗的典型特征。假设LC滤波器已经以损耗最小化进行了优化（损耗会增大滤波器的阻尼），因此品质因数很高，阻抗曲线具有严重的尖峰。引入反馈回路的目的之一就是最小化输出阻抗，使得负载发生在阶跃时，输出电压的跌落保持最小。如果选择的穿越频率在LC滤波器谐振频率以下，将没有足够的增益来消除谐振。并且即使具有良好的相位裕度，系统也将严重振荡。如果想要获得良好的瞬态响应，必须确保环路增益足够高，来抑制谐振尖峰。

2.  如图展示了电源受到剧烈负载变化时的典型响应。输出电容包含了两种杂散参数ESR和ESL。第一次下降时由于ESL的存在，它的幅值一般是$Ldi_{out}(t)/(dt)$，其中L是输出电容的ESL，$di_{out}/(dt)$是输出电流的变化率。。当电流达到最大值，然后变得平坦时，ESL上的电压下冲也随即消失。但电压还会继续下冲，直到控制环路调整回来。因此可以看到电压下冲值取决于输出电容和穿越频率。如果假设电流变化率比上文所述慢很多(例如大约为$1A/\mu s$，对于隔离变换器和通用电源来讲的典型值)ESL的影响就弱很多了，通常可以忽略。此时，电压的暂态响应只由电容和电阻构成。

    ![电流的阶跃响应.png](https://s2.loli.net/2023/08/06/xyi4dzWVBKcCJ8P.png)  

   ![电压跌落.png](https://s2.loli.net/2023/08/06/8HOlZn72wpbsqUB.png) 

   在没有ESL的情况下，第一次电压下冲是电容的ESR造成的，它看起来是竖直的。除了选择低ESR电容外，无法采取任何措施来减小它。第二次电压下降就纯粹是电容的作用了，它的幅值取决于若干因素，例如穿越频率、输出电容本身和电流变化的幅度。

3. 下面例子中，将根据变换器输出电压跌落这个重要指标来计算穿越频率。假设选择1000uF的输出电容(电容选择的依据包括:高温下的通流能力，体积和成本等)，从生产商的数据手册中，了解到其ESR值为30mΩ。假设设计要求是：当输出电流突然变化为2A时，输出电压最大跌落$V_p$为90mV。首先，计算ESR的影响:$V_{ESR}=\Delta I_{out}r_C=2A\times30m\Omega=60mV$。显然，如果这个压降超过了允许的最大压降值，那么只有选择一个拥有较小ESR的更大电容，或者采用多个电容器并联。当然，这个例子的情况不同，将尝试选择穿越频率来满足对电压下跌的要求。根据简化的阻抗表达式，可以选择合适的穿越频率，使得在ESR上的60mV压降加上1000uF电容的影响，输出电压总下跌低于90mV。对于2A的跳变，闭环下的输出阻抗必须低于$Z_{out}(f_c) <\frac{V_p}{\Delta I_{out}}<\frac{90mV}{2A}=45m\Omega$，由于电容值及其ESR值的离散性会达到30%或者40%，精确计算是没有意义的。穿越频率可以通过解下述方程获得$\sqrt{(\frac{1}{2\pi f_cC_{out}})^2+r_C^2}\approx Z_{out}(f_C)$，求解得到对穿越频率$f_C$的要求为$f_C >\frac{1}{2\pi C_{out}\sqrt{Z_{out}(f_C)^2-r_C^2}}=\frac{1}{6.28\times1mF\times\sqrt{45^2-30^2}m\Omega}=4.7kHz$。显然，这是一个近似值，需要在实验中进行验证。但是结果差不多。
4. 标准PID：$v_c(t)=k_p[\varepsilon(t)+\frac{1}{\tau_i}\int_0^1\varepsilon(t)dt+\tau_d\frac{d\varepsilon(t)}{dt}]$式中，$v(t)$是补偿器G输出的控制信号；$\varepsilon$是输出变量$y$和输出变量$u$之间的误差部分。
   + 第一项$P=k_p\varepsilon(t)$是比例项，用以生成一个与误差幅度成正比的控制信号。它的出发点是产生一个与输入/输出信号幅值成正比例的误差校正信号；如果误差很大，就得到一个相对较大的校正信号；如果误差信号较小，对应的校正信号就较小。$k_p$是调整比例项的参数，如果$k_p$较大，则响应速度较快，但存在超调风险；如果$k_p$较小，则系统响应速度较慢，但是不容易发生超调。
   + 第二项$I=\frac{1}{\tau_i}\int_0^1\varepsilon(t)dt$与误差信号的积分有关。它可以被当作是长期误差或偏移在时间上的积累或积分，只要输入和输出之间存在误差，就会生成一个校正信号，因此积分项可以消除设定值和输出值之间的静误差。在瞬态过程中，积分项会减缓响应速度并增加过冲。
   + $D=\tau_d\frac{d\varepsilon(t)}{dt}$与误差信号的微分有关。换句话说，与扰动或设定值变化的斜率有关。如果斜率非常陡，则该模块会产生较大的幅值。相反，缓慢变化的扰动会产生较低幅度的校正信号。
5. 拉普拉斯域的PID表达式：乘以s意味着微分，除以s意味着积分。$G(s)=\frac{v_c(s)}{\varepsilon(s)}=k_p(1+\frac{1}{s\tau_i}+s\tau_d)$.
6. P117

